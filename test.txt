SELECT
rtr.Patient_No,
rp.Test_DATE,
rtr.SPECIMEN_ID, 
rtr.REQUEST_ITEM_CODE,
err.DISPLAY_NAME AS REQUESTED_ITEM,
rtr.REQUEST_ITEM_ID,
rtr.TEST_CODE,
rtr.RESULT_TEXT,
ROUND(rtr.RESULT_NUMERIC,2) AS TEST_RESULT_NUM,
rtr.RANGE,
rs.CLINICAL_DETAILS ,
rr.DR_CODE,
d.TITLE || ' ' || d.FIRST_NAME || ' ' || d.LAST_NAME AS REQUEST_LEAD_CLINICIAN,
rr.SOURCE_CODE,
eps.DESCRIPTION AS REQUESTED_FROM,
prh.Measure_Date as HT_DATE,
prh.Result_Text as Height_CM,
prw.Measure_Date as WT_DATE,
prw.Result_Text as Weight_Kg
FROM
EPR.RES_TEST_RESULT rtr
Inner JOIN EPR.RES_SPECIMEN rs ON rs.SPECIMEN_ID = rtr.SPECIMEN_ID
Inner JOIN EPR.RES_REQUEST rr ON rr.RES_REQUEST_ID = rs.RES_REQUEST_ID
Inner JOIN EPR.ERR_REQUESTABLE_ITEM err ON err.REQUEST_CODE = rtr.REQUEST_ITEM_CODE AND err.REQUEST_TYPE = rtr.REQUEST_TYPE
AND err.SYSTEM_ID = rtr.SYSTEM_ID
Inner JOIN EPR.DOCTOR d ON d.DOCTOR_NO = rr.DR_CODE
Inner JOIN EPR.ERR_PATH_SOURCE eps ON eps.SOURCE_CODE = rr.SOURCE_CODE
Inner JOIN borcaf.Research_Patients rp ON rp.PATIENT_NO = rtr.PATIENT_NO
AND rs.TAKEN_DATE BETWEEN rp.TEST_DATE AND rp.TEST_DATE + 0.999999
LEFT JOIN EPR.PHYSIOLOGY_RESULT prh ON prh.PATIENT_NO = rtr.PATIENT_NO
AND prh.MEASURE_DATE BETWEEN rp.TEST_DATE - 7 AND rp.TEST_DATE + 7
AND prh.TEST_CODE = 'HEIG'
LEFT JOIN EPR.PHYSIOLOGY_RESULT prw ON prw.PATIENT_NO = rtr.PATIENT_NO
AND prw.MEASURE_DATE BETWEEN rp.TEST_DATE - 7 AND rp.TEST_DATE + 7
AND prw.TEST_CODE = 'WEIG'
